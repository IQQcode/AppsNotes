## 1. Fragmentçš„çŠ¶æ€

> Fragmentå¿…é¡»åµŒå…¥åˆ°Activityä¸­ä½¿ç”¨ï¼ŒFragmentç”Ÿå‘½å‘¨æœŸç›´æ¥å—åˆ°æ‰€åœ¨Activityçš„å½±å“ã€‚
>
> - å½“Activityæš‚åœï¼Œå®ƒæ‹¥æœ‰çš„Fragmentéƒ½æš‚åœ
> - Activityè¢«é”€æ¯ï¼Œå®ƒæ‹¥æœ‰çš„Fragmentéƒ½é”€æ¯

### è¿è¡ŒçŠ¶æ€

å½“ä¸€ä¸ªç¢ç‰‡æ˜¯å¯è§çš„ï¼Œå¹¶ä¸”å®ƒæ‰€å…³è”çš„æ´»åŠ¨æ­£å¤„äºè¿è¡ŒçŠ¶æ€æ—¶ï¼Œè¯¥ç¢ç‰‡ä¹Ÿå¤„äºè¿è¡ŒçŠ¶æ€ã€‚

### æš‚åœçŠ¶æ€

å½“ä¸€ä¸ªActivityè¿›å…¥æš‚åœçŠ¶æ€æ—¶ï¼ˆç”±äºå¦ä¸€ä¸ªæœªå æ»¡å±å¹•çš„æ´»åŠ¨è¢«æ·»åŠ åˆ°äº†æ ˆé¡¶ï¼‰ï¼Œä¸å®ƒç›¸å…³è”çš„å¯è§ç¢ç‰‡å°±ä¼šè¿›å…¥åˆ°æš‚åœçŠ¶æ€,**Fragmentæ‰€å…³è”çš„Activityå¤„äºæš‚åœï¼Œåˆ™è¯¥Fragmentä¹Ÿå¤„äºæš‚åœ**

### åœæ­¢çŠ¶æ€

å½“ä¸€ä¸ªActivityè¿›å…¥åœæ­¢çŠ¶æ€æ—¶ï¼Œä¸å®ƒç›¸å…³è”çš„ç¢ç‰‡å°±ä¼šè¿›å…¥åˆ°åœæ­¢çŠ¶æ€ï¼›æˆ–è€…é€šè¿‡è°ƒç”¨FragmentTransactionçš„`remove()` ã€`replace()` æ–¹æ³•å°†ç¢ç‰‡ä»æ´»åŠ¨ä¸­ç§»é™¤ï¼Œä½†å¦‚æœåœ¨äº‹åŠ¡æäº¤ä¹‹å‰è°ƒç”¨`addToBackStack()` æ–¹æ³•ï¼Œè¿™æ—¶çš„ç¢ç‰‡ä¹Ÿä¼šè¿›å…¥åˆ°åœæ­¢çŠ¶æ€ã€‚

æ€»çš„æ¥è¯´ï¼Œ**è¿›å…¥åœæ­¢çŠ¶æ€çš„ç¢ç‰‡å¯¹ç”¨æˆ·æ¥è¯´æ˜¯å®Œå…¨ä¸å¯è§çš„ï¼Œæœ‰å¯èƒ½ä¼šè¢«ç³»ç»Ÿå›æ”¶**ã€‚

### é”€æ¯çŠ¶æ€

Fragmentæ€»æ˜¯ä¾é™„äºActivityè€Œå­˜åœ¨çš„ï¼Œå› æ­¤å½“æ´»åŠ¨è¢«é”€æ¯æ—¶ï¼Œä¸å®ƒç›¸å…³è”çš„ç¢ç‰‡å°±ä¼šè¿›å…¥åˆ°é”€æ¯çŠ¶æ€ã€‚æˆ–è€…é€šè¿‡è°ƒç”¨FragmentTransactionçš„`remove()` ã€`replace()`æ–¹æ³•å°†ç¢ç‰‡ä»æ´»åŠ¨ä¸­ç§»é™¤ï¼Œä½†åœ¨äº‹åŠ¡æäº¤ä¹‹å‰å¹¶æ²¡æœ‰è°ƒç”¨`addToBackStack()`æ–¹æ³•ï¼Œè¿™æ—¶çš„ç¢ç‰‡ä¹Ÿä¼šè¿›å…¥åˆ°é”€æ¯çŠ¶æ€(è°ƒç”¨è¿›å…¥åœæ­¢çŠ¶æ€)ã€‚

## 2. Fragmentçš„ç”Ÿå‘½å‘¨æœŸ

![Fragmentæ¦‚è¿°ä¸ç”Ÿå‘½å‘¨æœŸ](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/20210325135107.png)

**onAttach()** å½“Fragmentä¸Activityå‘ç”Ÿå…³è”æ—¶è°ƒç”¨ï¼Œå¯ä»¥è·å¾—å¯¹åº”çš„Contextæˆ–Activity

**onCreateView()** åˆ›å»ºè¯¥Fragmentçš„è§†å›¾æ—¶è°ƒç”¨ï¼Œç”±äºFragmentçš„onCreateè°ƒç”¨æ—¶ï¼Œå…³è”çš„Activityå¯èƒ½æ²¡æœ‰åˆ›å»ºå¥½ï¼Œæ‰€ä»¥ä¸è¦æœ‰ä¾èµ–å¤–éƒ¨Activityå¸ƒå±€çš„æ“ä½œã€‚ä¾èµ–Activityçš„æ“ä½œå¯ä»¥æ”¾åœ¨onActivityCreateä¸­ã€‚

**onCreatedView()** ä¸ºFragmentåˆ›å»ºè§†å›¾ï¼ˆåŠ è½½å¸ƒå±€ï¼‰æ—¶è°ƒç”¨ï¼ˆç»™å½“å‰çš„fragmentç»˜åˆ¶UIå¸ƒå±€ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ›´æ–°UIï¼‰

**onActivityCreated()** ç¡®ä¿ä¸ç¢ç‰‡ç›¸å…³è”çš„æ´»åŠ¨ä¸€å®šå·²ç»åˆ›å»ºå®Œæ¯•çš„æ—¶å€™è°ƒç”¨ï¼Œå½“Activityçš„onCreateæ–¹æ³•è¿”å›æ—¶è°ƒç”¨

ä»¥ä¸Š4æ­¥åŒæ­¥äºActivityçš„`onCreate`

---------------------

**onStart()** Fragmentå¯è§æ—¶è°ƒç”¨ï¼Œå°†Fragmentå¯¹è±¡æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚åŒæ­¥äºActivityçš„onStart

**onResume()**  Fragmentå¯¹è±¡å¯è§å¹¶å¯ä¸ç”¨æˆ·äº¤äº’æ—¶è°ƒç”¨ã€‚åŒæ­¥äºActivityçš„onResume

**onPause()** Fragmentå¯¹è±¡ä¸ç”¨æˆ·ä¸å†äº¤äº’ã€‚åŒæ­¥äºActivityçš„onPause

**onStop()** Fragmentå¯¹è±¡ä¸å†æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚åŒæ­¥äºActivityçš„onStop

**onDestroyView()** ä¸onCreateViewç›¸å¯¹åº”ï¼ŒFragmentä¸­çš„å¸ƒå±€è¢«ç§»é™¤æ—¶è°ƒç”¨ï¼ˆè¡¨ç¤ºfragmenté”€æ¯ç›¸å…³è”çš„UIå¸ƒå±€ï¼‰

**onDestroy()** FragmentçŠ¶æ€æ¸…ç†å®Œæˆ

**onDetach()** ä¸onAttachç›¸å¯¹åº”ï¼Œå½“Fragmentä¸Activityå…³è”è¢«å–æ¶ˆæ—¶è°ƒç”¨ï¼ˆè„±ç¦»activityï¼‰

<br>

## 3. Fragmengç”Ÿå‘½å‘¨æœŸè°ƒç”¨åœºæ™¯

### 3.1 Fragmentçš„å˜åŒ–

**Fragmentè¢«åˆ›å»º**

```java
onAttach()â€“>onCreate()â€“>onCreateView()â€“>onActivityCreated()
```

**Fragmentæ˜¾ç¤º**

```java
onStart()â€“>onResume()
```

**Fragmentè¿›å…¥åå°æ¨¡å¼**

```java
onPause()â€“>onStop()â€“>onDestroyView()
```

**Fragmentè¢«é”€æ¯ï¼ˆæŒæœ‰å®ƒçš„activityè¢«é”€æ¯ï¼‰**

```java
onPause()â€“>onStop()â€“>onDestroyView()â€“>onDestroy()â€“>onDetach()
```

**Fragmenté‡æ–°æ¢å¤**

```java
onCreateView()â€“>onActivityCreated()â€“>onStart()â€“>onResume()
```

### 3.2 Fragmentç»“åˆActivityçš„å˜åŒ–

**1. Fragmentåœ¨Activityä¸­replace**

æ–°æ›¿æ¢çš„Fragmentï¼šonAttach-->onCreate-->onCreateView-->onViewCreated-->onActivityCreated--onStart-->onResume

è¢«æ›¿æ¢çš„Fragmentï¼šonPause-->onStop-->onDestroyView-->onDestroy-->onDestach

**2. Fragmentåœ¨Activityä¸­replaceå¹¶addToBackStack**

æ–°æ›¿æ¢çš„Fragmentï¼ˆæ²¡æœ‰åœ¨BackStackä¸­ï¼‰ï¼š

```java
onAttach-->onCreate-->onCreateView-->onViewCreated-->onActivityCreated-->onStart-->onResume
```

æ–°æ›¿æ¢çš„Fragmentï¼ˆåœ¨BackStackä¸­ï¼‰ï¼š

```java
onCreateView-->onViewCreated-->onActivityCreated-->onStart-->onResume
```

è¢«æ›¿æ¢çš„Fragmentï¼š

```java
onPause-->onStop-->onDestroyView
```

**3. Fragmentåœ¨ä¸Šè¿°æƒ…å†µä¸‹è¿›å…¥onResumeåï¼Œåˆ™è¿›å…¥äº†è¿è¡ŒçŠ¶æ€ï¼Œä»¥ä¸‹å››ä¸ªç”Ÿå‘½å‘¨æœŸå°†è·Ÿéšæ‰€å±çš„Activityä¸€èµ·è°ƒç”¨**

```java
onPause > onStop > onStart > onResume
```

**4. FragmentçŠ¶æ€ä¿å­˜startActivityForResultæ˜¯å“ªä¸ªç±»çš„æ–¹æ³•ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨**

Fragmentè°ƒç”¨startActivityForResult--->HostCallbacks.onStartActivityFromFragment--->Fragment.startActivityFromFragmentã€‚

**5. å¦‚ä½•å®ç°Fragmentçš„æ»‘åŠ¨**

ViewPageråµŒå¥—Fragmentå³å¯å®ç°æ»‘åŠ¨

**6. fragmentä¹‹é—´ä¼ é€’æ•°æ®çš„æ–¹å¼**

1. åœ¨åˆ›å»ºçš„Fragmentæ·»åŠ tagï¼Œä½¿ç”¨bundleä¼ å€¼
2. ä½¿ç”¨æ¥å£å›è°ƒä¼ å€¼
3. ä½¿ç”¨å¼€æºçš„EventBusä¼ å€¼

### 3.3 Fragmentåˆ‡æ¢ç”Ÿå‘½å‘¨æœŸå˜åŒ–

#### æƒ…å†µ1ï¼šé€šè¿‡addã€hideã€showæ–¹å¼åˆ‡æ¢Fragment

1ã€åˆå§‹åŒ–ï¼š

- Fragment1è½½å…¥ï¼š`onCreate() -> onCreateView() -> onStart() -> onResume()`

2ã€Fragment1åˆ‡æ¢åˆ°Fragment2:

- Fragment1éšè—ï¼š`onHiddenChanged()`
- Fragment2è½½å…¥ï¼š`onCreate() -> onCreateView() -> onStart() - >onResume()`

3ã€Fragment2åˆ‡æ¢åˆ°Fragment1

- Fragment1ï¼š`onHiddenChanged()`
- Fragment2ï¼š`onHiddenChanged()`

**é€šè¿‡addã€hideã€showæ–¹å¼åˆ‡æ¢Fragmentæ—¶æ‰€æœ‰çš„viewéƒ½ä¼šä¿å­˜åœ¨å†…å­˜ï¼Œä¸ä¼šé”€æ¯ä¸é‡å»º**

#### æƒ…å†µ2ï¼šé€šè¿‡replaceæ–¹å¼åˆ‡æ¢Fragment

1ã€åˆå§‹åŒ–

- Fragment1è½½å…¥ï¼š`onCreate()->onCreateView()->onStart()->onResume()`

2ã€Fragment1åˆ‡æ¢åˆ°Fragment2:

- Fragment1é”€æ¯ï¼š`onPause()->onStop()->onDestroyView()->onDestroy()`
- Fragment2è½½å…¥ï¼š`onCreate()->onCreateView()->onStart()->onResume()`

3ã€Fragment2åˆ‡æ¢åˆ°Fragment1:

- Fragment2é”€æ¯ï¼š`onPause()->onStop()->onDestroyView()->onDestroy()`
- Fragment1è½½å…¥ï¼š`onCreate()->onCreateView()->onStart()->onResume()`

**é€šè¿‡ replace æ–¹æ³•è¿›è¡Œæ›¿æ¢çš„æ—¶ï¼ŒFragment éƒ½æ˜¯è¿›è¡Œäº†é”€æ¯ï¼Œé‡å»ºçš„è¿‡ç¨‹ï¼Œç›¸å½“äºèµ°äº†ä¸€æ•´å¥—çš„ç”Ÿå‘½å‘¨æœŸ**

#### æƒ…å†µ3ï¼šé€šè¿‡ViewPageræ–¹å¼åˆ‡æ¢Fragment

1ã€åˆå§‹åŒ–

- Fragment1è½½å…¥ï¼š`onCreate()->onCreateView()->onStart()->onResume()`
- Fragment2è½½å…¥ï¼š`onCreate()->onCreateView()->onStart()->onResume()`

2ã€Fragment1åˆ‡æ¢åˆ°Fragment2:

- Fragment1ä¸å¯è§ï¼š`setUserVisVleHint(false)`
- Fragment2å¯è§ï¼š`setUserVisVleHint(true)`

3ã€Fragment2åˆ‡æ¢åˆ°Fragment1:

- Fragment1å¯è§ï¼š`setUserVisVleHint(true)`
- Fragment2ä¸å¯è§ï¼š`setUserVisVleHint(false)`

>  ä½¿ç”¨ViewPagerä¸Fragmentåˆ‡æ¢æ—¶ï¼ŒFragmentä¼šè¿›è¡Œé¢„åŠ è½½æ“ä½œï¼Œå³æ‰€æœ‰çš„Fragmentéƒ½ä¼šæå‰åˆå§‹åŒ–ã€‚

## 4. Fragmentä¸Activityç”Ÿå‘½å‘¨æœŸå¯¹æ¯”

![img](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202202261052419.png)

ä»è¿™ä¸ªå›¾ä¸Šå¯ä»¥çœ‹å‡ºactivityçš„çŠ¶æ€å†³å®šäº†Fragmentå¯èƒ½æ¥æ”¶åˆ°çš„å›è°ƒå‡½æ•°ã€‚

å½“Activityå¤„äº`Resumed`çŠ¶æ€æ—¶ï¼Œ**å¯ä»¥è‡ªç”±åœ°æ·»åŠ å’Œç§»é™¤Fragment**ã€‚**åªæœ‰Activityåœ¨ResumedçŠ¶æ€æ—¶ï¼ŒFragmentçš„çŠ¶æ€å¯ä»¥ç‹¬ç«‹æ”¹å˜ã€‚**ä½†æ˜¯ï¼Œå½“Activityç¦»å¼€ResumedçŠ¶æ€ï¼Œ**Fragmentçš„ç”Ÿå‘½å‘¨æœŸè¢«Activityæ§åˆ¶ã€‚**

## 5. ActivityåµŒå¥—Fragmentç”Ÿå‘½å‘¨æœŸå˜åŒ–

ç”±äºFragmentä¾èµ–Activityçš„å­˜åœ¨è€Œå­˜åœ¨ï¼ŒActivityçš„çŠ¶æ€å†³å®šäº†Fragmentå¯èƒ½æ¥æ”¶åˆ°çš„å›è°ƒå‡½æ•°ï¼Œæ•…åœ¨Activityç”Ÿå‘½å‘¨æœŸä¸­çš„æ–¹æ³•ä¸€èˆ¬å‡å…ˆäºFragmentç”Ÿå‘½å‘¨æœŸä¸­çš„æ–¹æ³•æ‰§è¡Œã€‚äº‹å®ä¸Šï¼ŒFragmentçš„ç”Ÿå‘½å‘¨æœŸé™¤äº†å®ƒç¬¬ä¸€æ¬¡åˆ›å»ºæˆ–é”€æ¯ä¹‹å¤–ï¼Œéƒ½æ˜¯ç”±Activityå¯åŠ¨ã€‚

**é¦–æ¬¡æ‰“å¼€ç•Œé¢ç”Ÿå‘½å‘¨æœŸå˜åŒ–**

![image-20220226111453132](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202202261114301.png)

**ç‚¹å‡»Homeè¿”å›ä¸»ç•Œé¢&è¿”å›**

![image-20220226115315065](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202202261153233.png)

`onSaveInstanceState()`ä¿å­˜çŠ¶æ€çš„æ–¹æ³•æ˜¯åœ¨onPause()ä¹‹åï¼ŒonStop()ä¹‹å‰ï¼ŒActivityä¸Fragmentåœ¨è¿™é‡Œæ˜¯åŒæ­¥çš„ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨onPauseå’ŒonStopé—´ä»»æ„æ—¶åˆ»è°ƒç”¨ï¼Œå†æ¬¡ä»æœ€è¿‘æ´»åŠ¨è¿”å›æ—¶ï¼Œactivityä¼šå¤šæ‰§è¡Œä¸€ä¸ªonRestart()æ–¹æ³•ï¼ŒFragmentæ— æ­¤æ–¹æ³•

> [ğŸ”—android onSaveInstanceStateæ–¹æ³•](https://www.jianshu.com/p/5dde143a143f)

**æ­£å¸¸é”€æ¯ï¼ˆåé€€é”®è¿”å›ï¼‰**

![image-20220226115830142](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202202261158282.png)

**åå°æ„å¤–é”€æ¯&è¿”å›ï¼ˆæ¨ªç«–å±åˆ‡æ¢ï¼‰**

![image-20220226122044731](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-later/202202261220903.png)

Activityä¼šé¢å¤–æ‰§è¡Œä¸€ä¸ªè¿˜åŸçŠ¶æ€çš„æ–¹æ³•onRestoreInstanceStateï¼Œä»‹äºonStartå’ŒonResumeä¹‹é—´



----------

ã€æ–‡ç« å‚è€ƒã€‘

1. ã€Œæä¸€æ©ã€ç¬¬äºŒç«  Fragment. https://blog.csdn.net/qq_29966203/article/details/90414221
