## 1. Asynctask简介

除了使用Handler**实现线程间通信**外，Android提供了一个工具类：AsyncTask，它使创建需要与用户界面交互的长时间运
行的任务变得更简单。**在没有AsyncTask之前，使用Handler + Thread实现异步任务**。相对来说AsyncTask更轻量级一些，适用于简单的异步处理，AsyncTask是对Handler和Thread的封装，封装了ThreadPool，效率更高。 	



### 相关API

AsyncTask是抽象类。AsyncTask定义了三种泛型类型`Params`，`Progress`和 `Result`

1. Params启动任务执行的输入参数，比如，HTTP请求的URL
2. Progress后台任务执行的百分比
3. Result后台执行任务最终返回的结果，比如String

**execute(Params...params)**

- 启动任务，开始任务的执行流程

**void onPreExecute()**

- 在分线程工作开始之前在 <font color=red>UIThread</font> 中执行，一般用来显示提示视图

**Result dolnBackground(Params... params)**

- 在 <font color=red>workerThread</font> 中执行，完成任务的主要工作，通常需要较长的时间

**void onPostExecute(Result result)**

- 在dolnBackground()执行完后在 <font color=red>UIThread</font> 中执行，一般用来更新界面

**publishProgress(Progress...values)**：在分线程中，发布当前进度

**void onProgressUpdate(Progress...values)**：在主线程中更新进度

```kotlin
// MyAsyncTask(this).execute()
private inner class MyAsyncTask : AsyncTask<String?, Int?, String?>() {
    // 执行任务之前触发的事件方法，可以在该方法中作一些初始化工作
    override fun onPreExecute() {
        super.onPreExecute()
    }
    /**
     * 类似于在线程中执行任务，不能访问UI组件
     * @param params Array<out String?>
     * @return String?
     */
    override fun doInBackground(vararg params: String?): String? {
        publishProgress(1) // 进度变化，onProgressUpdate会更新
        return null
    }
    /**
     * 更新进度值
     * @param values Array<out Int?>
     */
    override fun onProgressUpdate(vararg values: Int?) {
        super.onProgressUpdate(*values)
    }
}
```

