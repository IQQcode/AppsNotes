## Task与Back-Stack

### Task

**Task表示“作业”或“任务”，充当Activity的容器，<font color = red>Task使用Back-Stack保存管理各个Activity</font>**。在Android系统中，执行某个任务时可能存在多个与用户产生交互的Activity，Task则是这些Activity的容器。

**(1) 执行Task的多个Activity不一定属于同一个应用程序**

- 例如：A程序的Activity输入邮件内容，B程序的Activity来发送邮件

**(2) 执行Task的多个Activity中，可能有同一个Activity的多个实例**

- 例如：MainActivity也可以激活自身，而且可以反复操作，可能存在多个MainActivity的实例

### Back-Stack

Back-Stack表示“回退栈”，每个Back-Stack栈顶得Activity被置于前台，称之为**Foreground Avtivity(前台Activity)**，遵循栈的规则

我们新打开的Activity，由于是由Task来管理的，都是存储在了Back-Stack之中；**所以新的Activity是覆盖到了旧的Activity之上，显示的是当前处在栈顶的 Foreground-Activity**

![image-20210303112115158](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210303112115158.png)

- 在Android中，系统用Task Stack(Back Stack)结构来存储管理启动的Activity对象

- 一个应用启动，系统就会为其创建一个对应的Task Stack来存储并管理该应用的Activity对象

- 只有最上面的任务栈的栈顶的Activity才能显示在窗口中

这也符合我们看到的界面结构，新出现的Activity总是覆盖在之前的Activity之上，按**返回**键则回退至上一个Activity

### 【小结】

- Task作为一个容器，使用Back-Stack保存、管理Activity
- **用户在使用Android时，可以启动多个Task**
- 每个Task都是有聚合力的单元，它可以在用户启动一个新的Task或按下Home键时整体的被置于后台
- 无论Task是被置于前台还是后台，Back-Stack都是完整的保存。**因此，用户在执行某个Task时，另外启动了新的Task,则原Task被置于后台；但当原Task重新置于前台时，它的Back Stack依然存在。**

> 🚀就像我在用手机刷知乎，突然此时来了电话，那么被打开的知乎的ZHActivity就会被电话PhoneActivity覆盖。此时PhoneActivity位于前台栈顶，在Back-Stack中ZHActivity位于其下面。当我挂了电话之后，此时ZHActivity又回到了栈顶位置。
>
> 具体是回到知乎的首页、消息、我的的哪个Activity，要根据之前谁处在Back-Stack上面的位置，这都是被记录好了的

<br>

<hr>

<br>

## Activity的LaunchMode

LounchMode为启动模式，Activity的launchmode被配置为不同的值时，当尝试激活Activity时可能会受影响：

- 该Activity的实例数量不同
- 所在的Task不同(在Activity中通过`getTaskId`查看Task的ID)
- 在Back-Stack中的列表不同
- 在Back-Stack中各Activity经历的生命周期不同

在AndroidManifest中配置：

![image-20210303113521681](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210303113521681.png)

### Activity的4种launchMode

**standard 标准模式**

- 标准模式，每次激活Activity时均在当前任务栈中创建新的实例(**每次均创建新的实例**)

**singleTop 栈顶时唯一**

- 位于栈顶时唯一：如果当前Activity**已位于当前任务栈栈顶，则不会创新的实例**

**singleTask 独立于任务栈**

- 独立于任务栈，如果该Activity的实例不存在，创建并且**获得栈顶位置**；如果实例已存在，则将其上方的Activity均出在哪很，且该Activity获得栈顶位置

**singleInstance 实例唯一**

- 实例唯一，实例独占任务栈，且**无论哪个任务栈共享同一个Activity实例**