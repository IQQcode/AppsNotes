## 1. Activity的四种状态

**Running(运行)状态**：可见也可操作。一个新的Activity启动入栈后，它在屏幕最前端，处于栈的最顶端，此时它处于可见并可和用户交互的激活状态。

**Paused(暂停)状态**：可见但不可操作。当Activity被另一个透明或者Dialog样式的Activity覆盖时的状态。此时它依然与窗口管理器保持连接，系统继续维护其内部状态，它仍然可见，但它已经失去了焦点，故不可与用户交互。

**Stopped(停止)状态**：不可见，但对象存在。当Activity不可见时，Activity处于Stopped状态。当Activity处于此状态时，一定要保存当前数据和当前的UI状态，否则一旦Activity退出或关闭时，当前的数据和UI状态就丢失了。

**Killed(死亡)状态**：对象不存在。Activity被杀掉以后或者被启动以前，处于Killed状态。这是Activity已从Activity堆栈中移除，需要重新启动才可以显示和使用。

<font color = red>**4种状态中，Running状态和Paused状态是可见的，Stopped状态和Killed状态时不可见的。**</font>



## 2. Activity生命周期方法

1. onCreat()：当Activity第一次启动时调用
2. onRestart()：当Activity调用onStop()之后重新被用户可见时调用
3. onStart()：当onCreat()之后调用，或onResert()后调用
4. onResume()：当onStart()之后调用，或者onPause()之后重新被置入前台时调用
5. onPause()：当Activity被置于后台是调用
6. onStop()：当Activity不再被用户可见时调用
7. onDestroy：当Activity被销毁之前被调用

![activity_lifecycle](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/activity_lifecycle.png)

### Activity的状态结合方法

**运行态-Running**

- Activity处于前台，被用户可见，且可控
- Activity从创建到运行状态会经历：`onCreate() => onStart() => onResume()`

**暂停态-Paused**

- Activity被置于后台，可见但不可控
- Activity调用`onPause()`后进入该状态，如恢复运行，会调用`onResume()`

**停止态-Stopped**

- Activity被置于后台，不可见，亦不可控
- Activity调用`onStop()`后进入该状态，如恢复运行，调用`onRestart() => onStart() => onResume()`

**终止态-Destroyed**

- Activity被系统终止，资源进行回收
- Activity调用`onDestroy()`后进入该状态，如回复运行，需要新创建

![6196fc9ecbe17d54](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/6196fc9ecbe17d54.png)

当执行完`onResume()`方法之后，当前Activity才真正的全部显示完成

### onStart()和onResume()的区别

- onStart()是activity界面被显示出来的时候执行的，用户可见，包括有一个activity在他上面，但没有将它完全覆盖，**用户可以看到部分activity但不能与它交互**

- onResume()是当该activity与用户能进行交互时被执行，**用户可以获得activity的焦点**，能够与用户交互。

--------------------

- onStart()通常就是onStop()（也就是用户按下了home键，activity变为后台后），之后用户再切换回这个activity就会**调用onRestart()而后调用onStart()**

- onResume()是onPause()（通常是当前的acitivty被暂停了，比如被另一个透明或者Dialog样式的Activity覆盖了），之后dialog取消，activity回到可交互状态，调用onResume()。

-------------------



![image-20210306201637138](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210306201637138.png)

![image-20210306214604864](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210306214604864.png)

## 3. 生命周期测试

### 测试方法的流程

**1. App刚启动，来到MainActivity**

对照流程图，分别执行`onCreate() => onStart() => onResume()`，MainActivity获得焦点

![image-20210307084614750](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210307084614750.png)

**2. 点击SecondActivity按钮，激活第二个Activity**

此时第一个Activity处于**Paused暂停不可见**，被SecondActivity覆盖

SecondActivity分别执行`onCreate() => onStart() => onResume()`，获得焦点

在SecondActivity获得焦点之后，MainActivity进入**Stop(不可见，但对象存在)**

![image-20210307084634719](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210307084634719.png)

**3. 点击激活Main按钮，激活第一个MainActivity**

同理，此时SecondActivity被MainActivity覆盖，和上述步骤二一致

> 类比看书，当你在看完当前第二页时，翻页会将之前的一页 “遮挡”
>
> 在往回翻时，其又会被显示出来

<font color=red>**4. 若不点击 激活Main，而是点击 <返回键> 回到MainActivity**</font>

![image-20210307085913632](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210307085913632.png)

区别于激活，此时MainActivity并不是新创建`onCreate()`；因为其已存在回退栈栈中，点击 `<返回键>` 使SecondActivity退出Back-Stack，此时MainActivity位于前台栈顶，需要重新启动`onRestart()`

由于SecondActivity退出Back-Stack，所以执行完`onStop()`后，退出栈销毁，即执行`onDestroy()`

**5. 点击SmallAtivity按钮，激活第一个SmallActivity 部分遮挡MianActivity**

SmallActivity经历相同的三个过程，但是MainActivity **并没有被onStop()，虽然被置于SmallActivity之下，但是MainActivity仍然可见**

![image-20210307090732223](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210307090732223.png)

**点击 <返回键> 回到MainActivity**，MainActivity只需要`onResume()`获得焦点，并不需要重新启动`onRestart()`

![image-20210307091140483](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210307091140483.png)



<br>

### 测试各个状态的切换

> 三个途径都可来到onResume()

**界面从“死亡”-->“运行”  [启动应用]**

创建对象-->onCreat()-->onStart()-->onResume()

![image-20210223103952451](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223103952451.png)

**界面从“运行”-->“死亡”  [点返回键]**

onPause()-->onStop()-->onDestory()

![image-20210223104232296](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223104232296.png)

**界面从“运行”-->“停止” [点Home键]**

onPause()-->onStop()

![image-20210223104506866](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223104506866.png)

**界面从“停止”-->“运行”  [点完Home键之后，长按Home键回到应用]**

onRestart()-->onStart()-->onResume()

![image-20210223104709360](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223104709360.png)

**界面从“运行”-->“暂停”  [当前MainActivity跳转到另一个SecondActivity]**

onPause()

<img src="https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223120017228.png" alt="image-20210223120017228" width="30%" />

![image-20210223120111692](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223120111692.png)

**界面从“暂停”-->“运行”  [SecondActivity返回到MainActivity]**

onResume()

![image-20210223120252872](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img-2021-befo/image-20210223120252872.png)



### 4. 执行流程小结



当Activity第一次被启动：

```java
onCreate() => onStart() => onResume()
```

当Activity被遮挡：

```java
onPause() => onStop()
```

当按 <返回键> 时：

```java
onPause() => onStop() => onDestroy()
```

当Activity被遮挡后，按 <返回键> 再次显示：

```java
onPause() => onStop() => onDestroy()
```





